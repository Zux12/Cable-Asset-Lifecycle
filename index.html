<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Cable Lifecycle Calculator | O&G Plant Edition (v3.0)</title>
    <style>
        /* SCIENTIFIC / LABORATORY THEME */
        :root {
            --primary-color: #0056b3; /* Lab Blue */
            --bg-color: #f4f7f6;      /* Clean Grey */
            --card-bg: #ffffff;       /* Pure White */
            --text-main: #333333;     /* Dark Grey */
            --border-color: #e0e0e0;
            --success: #28a745;
            --warning: #ffc107;
            --danger: #dc3545;
        }

        body {
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-main);
            margin: 0;
            padding: 20px;
            line-height: 1.6;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: var(--card-bg);
            padding: 40px;
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
            border: 1px solid var(--border-color);
        }

        h1 {
            color: var(--primary-color);
            border-bottom: 2px solid var(--primary-color);
            padding-bottom: 10px;
            margin-top: 0;
        }

        h2 {
            font-size: 1.1rem;
            color: var(--text-main);
            margin-top: 25px;
            margin-bottom: 15px;
            border-left: 4px solid var(--primary-color);
            padding-left: 10px;
            background-color: #f9f9f9;
            padding-top: 5px;
            padding-bottom: 5px;
        }

        .input-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        
        @media (max-width: 768px) { .input-grid { grid-template-columns: 1fr; } }

        .form-group { margin-bottom: 15px; }
        
        label {
            display: block;
            font-weight: 600;
            margin-bottom: 5px;
            font-size: 0.9rem;
        }

        input[type="number"], select, input[type="range"] {
            width: 100%;
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 4px;
            font-size: 1rem;
            box-sizing: border-box;
        }

        .helper-text {
            font-size: 0.8rem;
            color: #666;
            display: block;
            margin-top: 4px;
        }

        /* RESULT BOX */
        .result-box {
            background-color: #eef2f5;
            border: 1px solid #d1d9e6;
            padding: 25px;
            margin-top: 30px;
            border-radius: 6px;
            text-align: center;
        }
        
        .rul-display {
            font-size: 3rem;
            font-weight: bold;
            color: var(--primary-color);
        }

        .status-badge {
            display: inline-block;
            padding: 5px 15px;
            border-radius: 20px;
            color: white;
            font-weight: bold;
            font-size: 0.9rem;
            margin-top: 5px;
        }

        /* BAR CHART */
        .breakdown-bar {
            height: 25px;
            width: 100%;
            background-color: #ddd;
            border-radius: 12px;
            overflow: hidden;
            display: flex;
            margin-top: 15px;
        }
        .bar-segment { height: 100%; transition: width 0.5s ease; }
        .legend { display: flex; justify-content: center; gap: 15px; font-size: 0.8rem; margin-top: 10px; }
        .dot { height: 10px; width: 10px; display: inline-block; border-radius: 50%; margin-right: 5px; }

    </style>
</head>
<body>

<div class="container">
    <h1>Cable Lifecycle Calculator v3.0 (O&G Edition)</h1>
    <p>Compliance: IEC 60216 (Thermal), IEEE 400.2 (Testing), NEK 606 (Mud/Oil).</p>

    <div style="background:#e3f2fd; padding:10px; border-radius:5px; margin-bottom:20px;">
        <strong>Analysis Mode:</strong>
        <label style="display:inline; margin-left:15px;"><input type="radio" name="mode" value="conservative" onchange="calculate()"> Conservative (Safety)</label>
        <label style="display:inline; margin-left:15px;"><input type="radio" name="mode" value="optimistic" checked onchange="calculate()"> Optimistic (Planning)</label>
    </div>

    <form id="calcForm">
        <h2>1. Asset Specification</h2>
        <div class="input-grid">
            <div class="form-group">
                <label>Insulation Material</label>
                <select id="material" onchange="updateDesignLife()">
                    <option value="XLPE">XLPE (Cross-linked PE) - Standard</option>
                    <option value="PVC">PVC (Polyvinyl Chloride) - Older Types</option>
                    <option value="EPR">EPR (Ethylene Propylene) - High Temp</option>
                </select>
            </div>
            <div class="form-group">
                <label>Design Life (Years)</label>
                <input type="number" id="designLife" value="40" oninput="calculate()">
                <span class="helper-text">Auto-updated based on material.</span>
            </div>
            <div class="form-group">
                <label>Current Age (Years)</label>
                <input type="number" id="age" value="30" oninput="calculate()">
            </div>
        </div>

        <h2>2. Operational Stress (Thermal/Load)</h2>
        <div class="input-grid">
            <div class="form-group">
                <label>Load Utilization (%)</label>
                <input type="number" id="utilization" value="10" oninput="calculate()">
                <span class="helper-text">Avg Load / Rated Capacity (e.g., 110VDC is usually <10%).</span>
            </div>
            <div class="form-group">
                <label>Duty Cycle (Hours per Day)</label>
                <input type="range" id="duty" min="1" max="24" value="24" oninput="document.getElementById('dutyVal').innerText=this.value; calculate()">
                <span class="helper-text">Active Hours: <span id="dutyVal">24</span> hrs/day</span>
            </div>
        </div>

        <h2>3. Installation Environment</h2>
        <div class="input-grid">
            <div class="form-group">
                <label>Vibration / Mechanical Stress</label>
                <select id="vibration" onchange="calculate()">
                    <option value="none">Static / No Vibration (Trench)</option>
                    <option value="moderate">Moderate (Near Pumps/Roads)</option>
                    <option value="high">High Vibration (Compressor/Bridge)</option>
                </select>
            </div>
            <div class="form-group">
                <label>Chemical / Oil Exposure (NEK 606)</label>
                <select id="chemical" onchange="calculate()">
                    <option value="none">Clean Environment</option>
                    <option value="splash">Occasional Oily Water</option>
                    <option value="immersion">Constant Oil/Sludge Immersion</option>
                </select>
            </div>
        </div>

        <h2>4. Diagnostic Test Results (If Available)</h2>
        <div class="input-grid">
            <div class="form-group">
                <label>VLF Tan Delta / Moisture (IEEE 400.2)</label>
                <select id="test_td" onchange="calculate()">
                    <option value="pass">Pass / No Data (Assume Normal)</option>
                    <option value="aging">Warning (Mod. Tip-Up / Aged)</option>
                    <option value="fail">Action Required (High Loss/Water Trees)</option>
                </select>
            </div>
            <div class="form-group">
                <label>Partial Discharge (IEC 60270)</label>
                <select id="test_pd" onchange="calculate()">
                    <option value="none">None Detected / Low Voltage</option>
                    <option value="low">Low Level (Trend Monitor)</option>
                    <option value="high">High/Critical PD Activity</option>
                </select>
            </div>
            <div class="form-group">
                <label>Insulation Resistance (Megger)</label>
                <select id="test_ir" onchange="calculate()">
                    <option value="good">Good (> 100 M立)</option>
                    <option value="low">Low (1 M立 - 100 M立)</option>
                    <option value="crit">Critical (< 1 M立)</option>
                </select>
            </div>
        </div>
    </form>

    <div class="result-box">
        <h3>Estimated Remaining Useful Life (RUL)</h3>
        <div id="rulValue" class="rul-display">-- Years</div>
        <div id="statusBadge" class="status-badge">Calculating...</div>
        
        <div style="margin-top:20px;">
            <div class="breakdown-bar">
                <div id="bar-age" class="bar-segment" style="background:#555;"></div>
                <div id="bar-pen" class="bar-segment" style="background:#dc3545;"></div>
                <div id="bar-rem" class="bar-segment" style="background:#28a745;"></div>
            </div>
            <div class="legend">
                <span><span class="dot" style="background:#555;"></span>Age</span>
                <span><span class="dot" style="background:#dc3545;"></span>Penalties</span>
                <span><span class="dot" style="background:#28a745;"></span>Remaining</span>
            </div>
        </div>
        <p id="recText" style="margin-top:15px; font-size:0.9rem;"></p>
    </div>
</div>

<script>
    function updateDesignLife() {
        const mat = document.getElementById('material').value;
        const dl = document.getElementById('designLife');
        if(mat === 'XLPE') dl.value = 40;
        if(mat === 'PVC') dl.value = 30; // PVC has shorter life
        if(mat === 'EPR') dl.value = 45;
        calculate();
    }

    function calculate() {
        // INPUTS
        const age = parseFloat(document.getElementById('age').value) || 0;
        const designLife = parseFloat(document.getElementById('designLife').value) || 40;
        const util = parseFloat(document.getElementById('utilization').value) / 100;
        const duty = parseFloat(document.getElementById('duty').value) / 24; // 0.0 to 1.0
        const mode = document.querySelector('input[name="mode"]:checked').value;
        const isConservative = (mode === 'conservative');

        // 1. THERMAL FACTOR (Physics)
        // If load is low (<20%), thermal aging is negligible.
        // Duty cycle reduces effective aging time.
        let f_thermal = 1.0;
        if (util < 0.20) {
            f_thermal = 1.25; // Life extension for lightly loaded cables
        } else if (util > 0.85) {
            f_thermal = 0.8; // Penalty for full load
        }
        
        // Apply Duty Cycle Benefit (only if thermal penalty exists or neutral)
        // If lightly loaded, duty cycle matters less (aging is calendar based).
        // If heavily loaded, duty cycle helps significantly.
        if (util > 0.5) {
            f_thermal = f_thermal * (1 + (1 - duty) * 0.5); 
        }

        // 2. DEFINE PENALTIES [Conservative, Optimistic]
        const penalties = {
            vibration: { none: [1.0, 1.0], moderate: [0.85, 0.90], high: [0.60, 0.70] },
            chemical: { none: [1.0, 1.0], splash: [0.85, 0.90], immersion: [0.50, 0.70] },
            test_td: { pass: [1.0, 1.0], aging: [0.75, 0.85], fail: [0.40, 0.50] }, // Severe for Water Trees
            test_pd: { none: [1.0, 1.0], low: [0.80, 0.90], high: [0.20, 0.30] },   // Critical for PD
            test_ir: { good: [1.0, 1.0], low: [0.70, 0.80], crit: [0.10, 0.20] }    // Critical for Insulation Resistance
        };

        const idx = isConservative ? 0 : 1;

        // GET VALUES
        const p_vib = penalties.vibration[document.getElementById('vibration').value][idx];
        const p_chem = penalties.chemical[document.getElementById('chemical').value][idx];
        const p_td = penalties.test_td[document.getElementById('test_td').value][idx];
        const p_pd = penalties.test_pd[document.getElementById('test_pd').value][idx];
        const p_ir = penalties.test_ir[document.getElementById('test_ir').value][idx];

        // 3. CALCULATE TOTAL ESTIMATED LIFE
        // Base Life * Thermal Factor * Mechanical/Chem Penalties * Diagnostic Penalties
        let totalLife = designLife * f_thermal * p_vib * p_chem * p_td * p_pd * p_ir;

        // Cap reasonable limits
        if (totalLife > designLife * 1.5) totalLife = designLife * 1.5;

        let remaining = totalLife - age;
        if (remaining < 0) remaining = 0;

        // 4. DISPLAY
        document.getElementById('rulValue').innerText = remaining.toFixed(1) + " Years";
        
        // Badge Logic
        const badge = document.getElementById('statusBadge');
        const recText = document.getElementById('recText');

        if (remaining > 10) {
            badge.innerText = "Healthy / Low Risk";
            badge.style.backgroundColor = "var(--success)";
            recText.innerText = "Condition is acceptable. Continue routine maintenance.";
        } else if (remaining > 3) {
            badge.innerText = "Warning / Monitor";
            badge.style.backgroundColor = "var(--warning)";
            badge.style.color = "#333";
            recText.innerText = "Asset degrading. Plan for replacement within 3-5 years or perform advanced diagnostics.";
        } else {
            badge.innerText = "Critical / Replace";
            badge.style.backgroundColor = "var(--danger)";
            recText.innerText = "Asset has exceeded reliable life. Immediate replacement recommended.";
        }

        // Charts
        let totalDisplay = Math.max(age + remaining, totalLife);
        let pctAge = (age / totalDisplay) * 100;
        let pctRem = (remaining / totalDisplay) * 100;
        let pctPen = 100 - pctAge - pctRem;
        
        document.getElementById('bar-age').style.width = pctAge + "%";
        document.getElementById('bar-pen').style.width = pctPen + "%";
        document.getElementById('bar-rem').style.width = pctRem + "%";
    }

    // Init
    calculate();
</script>

</body>
</html>
