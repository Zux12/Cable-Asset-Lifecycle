<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cable Lifecycle Calculator | O&G Summit Edition (v10.0)</title>
    <style>
        :root {
            --primary-color: #001219; /* Deepest Black/Blue */
            --secondary-color: #005f73;
            --accent-color: #ae2012;  /* Alert Red */
            --bg-color: #e9ecef;
            --card-bg: #ffffff;
            --text-main: #212529;
            --success: #0a9396;
            --warning: #ee9b00;
            --danger: #9b2226;
        }

        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-main);
            margin: 0;
            padding: 20px;
            line-height: 1.6;
        }

        .container {
            max-width: 1350px;
            margin: 0 auto;
            background: var(--card-bg);
            padding: 50px;
            border-radius: 16px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.12);
            border: 1px solid #dee2e6;
        }

        /* HEADER */
        h1 {
            color: var(--primary-color);
            border-bottom: 6px solid var(--secondary-color);
            padding-bottom: 20px;
            margin-top: 0;
            font-size: 2.5rem;
            text-transform: uppercase;
            letter-spacing: 2px;
            font-weight: 900;
        }

        /* STANDARDS GRID */
        .standards-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
            gap: 12px;
            margin-bottom: 40px;
        }

        .std-badge {
            background: #f8f9fa;
            color: #343a40;
            padding: 10px;
            border-radius: 6px;
            font-size: 0.75rem;
            font-weight: 700;
            border: 1px solid #ced4da;
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }
        
        .std-badge:hover { transform: translateY(-2px); box-shadow: 0 4px 8px rgba(0,0,0,0.1); }
        .std-badge.critical { border-color: var(--accent-color); color: var(--accent-color); background: #fff5f5; }

        /* SECTIONS */
        h2 {
            font-size: 1.2rem;
            color: #fff;
            background: linear-gradient(90deg, #001219 0%, #005f73 100%);
            padding: 15px 30px;
            border-radius: 8px;
            margin-top: 50px;
            margin-bottom: 30px;
            display: flex;
            align-items: center;
            text-transform: uppercase;
            letter-spacing: 1px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        /* FORM GRID */
        .input-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 30px;
        }

        .form-group { margin-bottom: 10px; }

        label {
            display: block;
            font-weight: 800;
            margin-bottom: 8px;
            font-size: 0.95rem;
            color: #212529;
        }

        select, input[type="number"], input[type="range"] {
            width: 100%;
            padding: 15px;
            border: 1px solid #ced4da;
            border-radius: 6px;
            font-size: 1rem;
            background-color: #fff;
            box-sizing: border-box;
            transition: border-color 0.2s;
        }

        select:focus, input:focus {
            outline: none;
            border-color: var(--secondary-color);
            box-shadow: 0 0 0 4px rgba(0, 95, 115, 0.15);
        }

        .helper-text {
            font-size: 0.8rem;
            color: #6c757d;
            margin-top: 6px;
            display: block;
            font-style: italic;
        }

        /* RESULTS AREA */
        .result-panel {
            background: #ffffff;
            border: 2px solid #e9ecef;
            padding: 50px;
            margin-top: 60px;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 25px 50px rgba(0,0,0,0.08);
        }

        .rul-display {
            font-size: 6rem;
            font-weight: 900;
            color: var(--primary-color);
            line-height: 1;
            margin: 25px 0;
            letter-spacing: -2px;
        }

        .status-badge {
            display: inline-block;
            padding: 15px 50px;
            border-radius: 50px;
            color: white;
            font-weight: 800;
            font-size: 1.4rem;
            text-transform: uppercase;
            letter-spacing: 1.5px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.15);
        }

        /* CHARTS */
        .breakdown-bar {
            height: 50px;
            width: 100%;
            background-color: #e9ecef;
            border-radius: 25px;
            overflow: hidden;
            display: flex;
            margin-top: 50px;
            border: 1px solid #dee2e6;
        }

        .bar-segment { height: 100%; transition: width 1.2s cubic-bezier(0.22, 1, 0.36, 1); }

        .legend {
            display: flex;
            justify-content: center;
            gap: 30px;
            font-size: 1rem;
            margin-top: 30px;
            color: #495057;
            font-weight: 700;
        }
        
        .dot { height: 16px; width: 16px; display: inline-block; margin-right: 10px; border-radius: 4px; vertical-align: middle;}

        /* TOGGLE */
        .mode-wrapper {
            background: #e0fbfc;
            padding: 20px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            gap: 30px;
            border: 1px solid #98c1d9;
            margin-bottom: 40px;
            color: #293241;
        }
        .mode-wrapper label { margin: 0; cursor: pointer; display: flex; align-items: center; font-weight: 700; font-size: 1.1rem;}
        .mode-wrapper input { width: auto; margin-right: 12px; transform: scale(1.3); }

    </style>
</head>
<body>

<div class="container">
    <h1>Cable Lifecycle Calculator v10.0</h1>
    
    <div class="standards-grid">
        <div class="std-badge">IEC 60216 (Thermal)</div>
        <div class="std-badge">IEEE 400.2 (VLF)</div>
        <div class="std-badge">IEC 60270 (PD)</div>
        <div class="std-badge">IEC 60949 (Faults)</div>
        <div class="std-badge">ISA 71.04 (H2S)</div>
        <div class="std-badge">CIGRE 852 (DC)</div>
        <div class="std-badge critical">IEC 60364 (Grouping)</div>
        <div class="std-badge critical">IEC 60079 (Ex-Safe)</div>
        <div class="std-badge">NACE SP0169 (Galvanic)</div>
        <div class="std-badge">IEEE 1425 (Wet/Dry)</div>
        <div class="std-badge critical">API 540 (Heat)</div>
        <div class="std-badge critical">IEC 60068 (UV)</div>
        <div class="std-badge">ISO 55000 (Maint)</div>
        <div class="std-badge">IEC 60502 (Bending)</div>
        <div class="std-badge">IEEE 1100 (Kickback)</div>
        <div class="std-badge">IEC 62305 (Lightning)</div>
    </div>

    <div class="mode-wrapper">
        <strong>Simulation Strategy:</strong>
        <label><input type="radio" name="mode" value="conservative" onchange="calculate()"> Conservative (Risk Averse)</label>
        <label><input type="radio" name="mode" value="optimistic" checked onchange="calculate()"> Optimistic (Planning Base)</label>
    </div>

    <form id="calcForm">
        
        <h2>1. Asset Design & Baseline</h2>
        <div class="input-grid">
            <div class="form-group">
                <label>Insulation Material</label>
                <select id="material" onchange="updateDesignLife()">
                    <option value="XLPE">XLPE (Standard)</option>
                    <option value="PVC">PVC (Legacy - Heat Sensitive)</option>
                    <option value="EPR">EPR (High Temp)</option>
                </select>
            </div>
            <div class="form-group">
                <label>Design Life (Years)</label>
                <input type="number" id="designLife" value="40" oninput="calculate()">
            </div>
            <div class="form-group">
                <label>Years in Service</label>
                <input type="number" id="age" value="30" oninput="calculate()">
            </div>
            <div class="form-group">
                <label>DC Application (CIGRE 852)</label>
                <select id="dc_grade" onchange="calculate()">
                    <option value="ac">AC Service</option>
                    <option value="dc_std">DC on AC Cable (Space Charge Risk)</option>
                    <option value="dc_special">DC on DC Cable (Safe)</option>
                </select>
            </div>
        </div>

        <h2>2. Electrical Physics & Grouping</h2>
        <div class="input-grid">
            <div class="form-group">
                <label>Load Utilization (Self-Heating)</label>
                <input type="number" id="utilization" value="10" oninput="calculate()">
            </div>
            <div class="form-group">
                <label>Cable Grouping / Bundling (IEC 60364)</label>
                <select id="grouping" onchange="calculate()">
                    <option value="single">Isolated / Single Layer</option>
                    <option value="bundled">Bundled in Tray (Shared Heat)</option>
                    <option value="packed">Overcrowded / Multi-layer</option>
                </select>
                <span class="helper-text">Heat from neighbors derates life.</span>
            </div>
            <div class="form-group">
                <label>Internal Surge (Solenoid Kickback)</label>
                <select id="surge" onchange="calculate()">
                    <option value="protected">Protected (Diode)</option>
                    <option value="unprotected">Unprotected (Spikes)</option>
                </select>
            </div>
            <div class="form-group">
                <label>External Surge (Lightning)</label>
                <select id="lightning" onchange="calculate()">
                    <option value="low">Shielded / Low Risk</option>
                    <option value="medium">Medium</option>
                    <option value="high">High / Exposed Tropics</option>
                </select>
            </div>
        </div>

        <h2>3. Thermal & Installation Context</h2>
        <div class="input-grid">
            <div class="form-group">
                <label>Process Heat Proximity (API 540)</label>
                <select id="process_heat" onchange="calculate()">
                    <option value="none">Ambient Air Only</option>
                    <option value="near">Near Process Pipe (< 2m)</option>
                    <option value="contact">Contact / Radiation Zone</option>
                </select>
            </div>
            <div class="form-group">
                <label>Installation Bends (IEC 60502)</label>
                <select id="bends" onchange="calculate()">
                    <option value="good">Standard Radius</option>
                    <option value="tight">Tight Bends (Crazing)</option>
                </select>
            </div>
            <div class="form-group">
                <label>Soil Thermal Resistivity</label>
                <select id="soil_rho" onchange="calculate()">
                    <option value="wet">Wet/Clay (Good Cooling)</option>
                    <option value="normal" selected>Normal</option>
                    <option value="dry">Dry Sand (Poor Cooling)</option>
                </select>
            </div>
            <div class="form-group">
                <label>Solar / UV Radiation (IEC 60068)</label>
                <select id="uv" onchange="calculate()">
                    <option value="shaded">Shaded / Buried</option>
                    <option value="exposed">Exposed (Jacket Cracking)</option>
                </select>
            </div>
        </div>

        <h2>4. Integrity, Safety & Maintenance</h2>
        <div class="input-grid">
            <div class="form-group">
                <label>Hazardous Area (Ex) Integrity</label>
                <select id="ex_integrity" onchange="calculate()">
                    <option value="good">Tight / Certified</option>
                    <option value="loose">Loose / Cold Flow</option>
                </select>
                <span class="helper-text">IEC 60079 Compliance.</span>
            </div>
            <div class="form-group">
                <label>Armour Type</label>
                <select id="armour" onchange="calculate()">
                    <option value="swa">Armoured (SWA)</option>
                    <option value="none">Unarmoured (Pest Risk)</option>
                </select>
            </div>
            <div class="form-group">
                <label>Sheath Condition (IEC 60229)</label>
                <select id="sheath" onchange="calculate()">
                    <option value="intact">Intact / Passes Test</option>
                    <option value="damaged">Damaged / Pinholes</option>
                </select>
            </div>
            <div class="form-group">
                <label>Maintenance Strategy</label>
                <select id="maintenance" onchange="calculate()">
                    <option value="preventive">Preventive (ISO 55000)</option>
                    <option value="run_fail">Run-to-Failure</option>
                </select>
            </div>
        </div>
        
        <h2>5. Environmental Aggressors</h2>
        <div class="input-grid">
            <div class="form-group">
                <label>Atmosphere (Corrosion)</label>
                <select id="atmosphere" onchange="calculate()">
                    <option value="clean">G1 Clean</option>
                    <option value="industrial">G2 Industrial</option>
                    <option value="harsh">G3 Harsh (H2S)</option>
                </select>
            </div>
            <div class="form-group">
                <label>Chemical/Oil Exposure</label>
                <select id="chemical" onchange="calculate()">
                    <option value="none">None</option>
                    <option value="splash">Splash</option>
                    <option value="immersion">Immersion (Swelling)</option>
                </select>
            </div>
            <div class="form-group">
                <label>Wet/Dry Cycles (IEEE 1425)</label>
                <select id="wet_dry" onchange="calculate()">
                    <option value="stable">Stable (Deep Burial)</option>
                    <option value="cyclic">Cyclic (Pumping Effect)</option>
                </select>
            </div>
            <div class="form-group">
                <label>Galvanic Corrosion</label>
                <select id="galvanic" onchange="calculate()">
                    <option value="isolated">Isolated</option>
                    <option value="active">Active (Armour Rot)</option>
                </select>
            </div>
        </div>

        <h2>6. Diagnostics (Measured Data)</h2>
        <div class="input-grid">
            <div class="form-group">
                <label>VLF Tan Delta (IEEE 400.2)</label>
                <select id="test_td" onchange="calculate()">
                    <option value="pass">Pass / No Data</option>
                    <option value="aging">Aging (Tip-Up > 5)</option>
                    <option value="fail">Action Required</option>
                </select>
            </div>
            <div class="form-group">
                <label>Visual Inspection (API 14F)</label>
                <select id="visual" onchange="calculate()">
                    <option value="good">Good / Intact</option>
                    <option value="minor">Minor Aging</option>
                    <option value="poor">Poor (Cracked)</option>
                </select>
            </div>
            <div class="form-group">
                <label>Partial Discharge (IEC 60270)</label>
                <select id="test_pd" onchange="calculate()">
                    <option value="none">None Detected</option>
                    <option value="low">Low Level</option>
                    <option value="high">Critical PD</option>
                </select>
            </div>
            <div class="form-group">
                <label>Insulation Resistance</label>
                <select id="test_ir" onchange="calculate()">
                    <option value="good">Good (>100 MΩ)</option>
                    <option value="low">Low (1-100 MΩ)</option>
                    <option value="crit">Critical (<1 MΩ)</option>
                </select>
            </div>
        </div>

    </form>

    <div class="result-panel">
        <h3 style="margin:0 0 10px 0; color:#888; text-transform:uppercase; font-size:1rem; letter-spacing:2px;">Calculated Remaining Useful Life (RUL)</h3>
        <div id="rulValue" class="rul-display">-- Years</div>
        <div id="statusBadge" class="status-badge">Processing</div>
        
        <div style="margin-top: 50px;">
            <div class="breakdown-bar">
                <div id="bar-age" class="bar-segment" style="background:#6c757d;"></div>
                <div id="bar-pen" class="bar-segment" style="background:#d90429;"></div>
                <div id="bar-rem" class="bar-segment" style="background:#0a9396;"></div>
            </div>
            <div class="legend">
                <span><span class="dot" style="background:#6c757d;"></span>Age Consumed</span>
                <span><span class="dot" style="background:#d90429;"></span>Total Derating</span>
                <span><span class="dot" style="background:#0a9396;"></span>Remaining Life</span>
            </div>
        </div>
        <p id="recText" style="margin-top:40px; font-weight:500; color:#343a40; max-width:950px; margin-left:auto; margin-right:auto; font-size:1.2rem; line-height:1.6;"></p>
    </div>
</div>

<script>
    function updateDesignLife() {
        const mat = document.getElementById('material').value;
        const dl = document.getElementById('designLife');
        if(mat === 'XLPE') dl.value = 40;
        if(mat === 'PVC') dl.value = 30;
        if(mat === 'EPR') dl.value = 45;
        calculate();
    }

    function calculate() {
        // --- INPUTS ---
        const age = parseFloat(document.getElementById('age').value) || 0;
        const designLife = parseFloat(document.getElementById('designLife').value) || 40;
        const util = parseFloat(document.getElementById('utilization').value) / 100;
        const mode = document.querySelector('input[name="mode"]:checked').value;
        const isConservative = (mode === 'conservative');
        const idx = isConservative ? 0 : 1; 

        // --- THERMAL PHYSICS ---
        let f_thermal = 1.0;
        if (util < 0.20) f_thermal = 1.25; 
        else if (util > 0.85) f_thermal = 0.8; 
        
        const dcType = document.getElementById('dc_grade').value;
        let p_dc = 1.0;
        if (dcType === 'dc_std') p_dc = 0.75; 

        // --- PENALTY FACTORS ---
        const factors = {
            // Electrical & Grouping
            grouping: { single: [1.0, 1.0], bundled: [0.85, 0.90], packed: [0.70, 0.80] }, // NEW
            surge: { protected: [1.0, 1.0], unprotected: [0.75, 0.85] },
            lightning: { low: [1.0, 1.0], medium: [0.90, 0.95], high: [0.75, 0.85] },
            faults: { clean: [1.0, 1.0], few: [0.90, 0.95], frequent: [0.70, 0.80] },
            
            // Thermal/Install
            process_heat: { none: [1.0, 1.0], near: [0.60, 0.70], contact: [0.40, 0.50] },
            bends: { good: [1.0, 1.0], tight: [0.70, 0.80] },
            soil_rho: { wet: [1.05, 1.05], normal: [1.0, 1.0], dry: [0.80, 0.90] },
            uv: { shaded: [1.0, 1.0], exposed: [0.60, 0.75] },

            // Safety & Integrity
            ex_integrity: { good: [1.0, 1.0], loose: [0.50, 0.60] },
            armour: { swa: [1.0, 1.0], none: [0.70, 0.80] },
            sheath: { intact: [1.0, 1.0], damaged: [0.50, 0.60] },
            maintenance: { preventive: [1.05, 1.10], run_fail: [0.90, 0.95] },

            // Environment
            atm: { clean: [1.0, 1.0], industrial: [0.90, 0.95], harsh: [0.70, 0.80] },
            chem: { none: [1.0, 1.0], splash: [0.85, 0.90], immersion: [0.50, 0.70] },
            wet_dry: { stable: [1.0, 1.0], cyclic: [0.80, 0.90] },
            galvanic: { isolated: [1.0, 1.0], active: [0.85, 0.90] },
            
            // Diagnostics
            visual: { good: [1.0, 1.0], minor: [0.85, 0.90], poor: [0.50, 0.60] },
            td: { pass: [1.0, 1.0], aging: [0.75, 0.85], fail: [0.40, 0.50] },
            pd: { none: [1.0, 1.0], low: [0.80, 0.90], high: [0.20, 0.30] },
            ir: { good: [1.0, 1.0], low: [0.70, 0.80], crit: [0.10, 0.20] }
        };

        const p_group = factors.grouping[document.getElementById('grouping').value][idx]; // NEW
        const p_surge = factors.surge[document.getElementById('surge').value][idx];
        const p_lightning = factors.lightning[document.getElementById('lightning').value][idx];
        const p_faults = factors.faults[document.getElementById('faults').value][idx];
        
        const p_heat = factors.process_heat[document.getElementById('process_heat').value][idx];
        const p_bends = factors.bends[document.getElementById('bends').value][idx];
        const p_soil = factors.soil_rho[document.getElementById('soil_rho').value][idx]; 
        const p_uv = factors.uv[document.getElementById('uv').value][idx];

        const p_ex = factors.ex_integrity[document.getElementById('ex_integrity').value][idx];
        const p_armour = factors.armour[document.getElementById('armour').value][idx];
        const p_sheath = factors.sheath[document.getElementById('sheath').value][idx];
        const p_maint = factors.maintenance[document.getElementById('maintenance').value][idx];

        const p_atm = factors.atm[document.getElementById('atmosphere').value][idx];
        const p_chem = factors.chem[document.getElementById('chemical').value][idx];
        const p_wetdry = factors.wet_dry[document.getElementById('wet_dry').value][idx];
        const p_galvanic = factors.galvanic[document.getElementById('galvanic').value][idx];
        
        const p_visual = factors.visual[document.getElementById('visual').value][idx];
        const p_td = factors.td[document.getElementById('test_td').value][idx];
        const p_pd = factors.pd[document.getElementById('test_pd').value][idx];
        const p_ir = factors.ir[document.getElementById('test_ir').value][idx];

        // --- MASTER CALCULATION ---
        let totalLife = designLife * f_thermal * p_dc * (
            p_group * p_surge * p_lightning * p_faults * p_heat * p_bends * p_soil * p_uv * p_ex * p_armour * p_sheath * p_maint * p_atm * p_chem * p_wetdry * p_galvanic * p_visual * p_td * p_pd * p_ir
        );

        if (totalLife > designLife * 1.6) totalLife = designLife * 1.6;

        let remaining = totalLife - age;
        if (remaining < 0) remaining = 0;

        // --- UI UPDATES ---
        document.getElementById('rulValue').innerText = remaining.toFixed(1) + " Years";
        
        const badge = document.getElementById('statusBadge');
        const rec = document.getElementById('recText');

        if (remaining > 12) {
            badge.innerText = "Healthy / Low Risk";
            badge.style.backgroundColor = "var(--success)";
            rec.innerText = "Asset Condition: EXCELLENT. \nThe combination of low thermal grouping, robust protection, and safe environment indicates a long service life ahead. \nAction: Continue routine ISO 55000 compliant inspections.";
        } else if (remaining > 5) {
            badge.innerText = "Warning / Monitor";
            badge.style.backgroundColor = "var(--warning)";
            rec.innerText = "Asset Condition: AGING. \nEnvironmental or Operational stress (like Bundling or Heat) is visible. The safety margin is reducing. \nAction: Schedule VLF Tan Delta diagnostics and verify Ex-Gland integrity.";
        } else {
            badge.innerText = "Critical / Replace";
            badge.style.backgroundColor = "var(--danger)";
            rec.innerText = "Asset Condition: END OF RELIABLE LIFE. \nStatistical probability of failure is HIGH. Continued operation may compromise Process Safety. \nAction: Prioritize for immediate replacement.";
        }

        let totalDisplay = Math.max(age + remaining, totalLife);
        let pctAge = (age / totalDisplay) * 100;
        let pctRem = (remaining / totalDisplay) * 100;
        let pctPen = 100 - pctAge - pctRem;
        if(pctPen < 0) pctPen = 0;

        document.getElementById('bar-age').style.width = pctAge + "%";
        document.getElementById('bar-pen').style.width = pctPen + "%";
        document.getElementById('bar-rem').style.width = pctRem + "%";
    }

    calculate();
</script>

</body>
</html>
